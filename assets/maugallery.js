class mauGallery{constructor(element,options){this.element=element;this.options=Object.assign(mauGallery.defaults,options);this.tagsCollection=[];this.createRowWrapper();if(this.options.lightBox){this.createLightBox()}
this.addListeners();this.element.querySelectorAll(".gallery-item").forEach((item)=>{this.responsiveImageItem(item);this.moveItemInRowWrapper(item);this.wrapItemInColumn(item);const theTag=item.dataset.galleryTag;if(this.options.showTags&&theTag!==undefined&&!this.tagsCollection.includes(theTag)){this.tagsCollection.push(theTag)}});if(this.options.showTags){this.showItemTags()}
this.element.style.display='block'}
static get defaults(){return{columns:3,lightBox:!0,lightboxId:null,showTags:!0,tagsPosition:"bottom",navigation:!0}}
addListeners(){this.element.addEventListener("click",(e)=>{if(e.target.classList.contains("gallery-item")){if(this.options.lightBox&&e.target.tagName==="IMG"){this.openLightBox(e.target)}}});this.element.addEventListener("click",(e)=>{if(e.target.classList.contains("nav-link")){this.filterByTag(e)}else if(e.target.classList.contains("mg-prev")){this.prevImage()}else if(e.target.classList.contains("mg-next")){this.nextImage()}})}
createRowWrapper(){if(!this.element.querySelector('.gallery-items-row')){const row=document.createElement('div');row.className='gallery-items-row row';this.element.appendChild(row)}}
wrapItemInColumn(element){const columns=this.options.columns;const columnClasses=this.getColumnClasses(columns);const wrapper=document.createElement('div');wrapper.className=`item-column mb-4 ${columnClasses}`;element.parentNode.insertBefore(wrapper,element);wrapper.appendChild(element)}
getColumnClasses(columns){if(typeof columns==='number'){return `col-${Math.ceil(12 / columns)}`}else if(typeof columns==='object'){let columnClasses='';if(columns.xs)columnClasses+=`col-${Math.ceil(12 / columns.xs)} `;if(columns.sm)columnClasses+=`col-sm-${Math.ceil(12 / columns.sm)} `;if(columns.md)columnClasses+=`col-md-${Math.ceil(12 / columns.md)} `;if(columns.lg)columnClasses+=`col-lg-${Math.ceil(12 / columns.lg)} `;if(columns.xl)columnClasses+=`col-xl-${Math.ceil(12 / columns.xl)} `;return columnClasses.trim()}else{console.error(`Columns should be defined as numbers or objects. ${typeof columns} is not supported.`);return''}}
moveItemInRowWrapper(element){this.element.querySelector(".gallery-items-row").appendChild(element)}
responsiveImageItem(element){if(element.tagName==="IMG"){element.classList.add("img-fluid")}}
openLightBox(element){const lightboxId=this.options.lightboxId||"galleryLightbox";const lightboxImage=document.querySelector(`#${lightboxId} .lightboxImage`);lightboxImage.src=element.src;const modal=new bootstrap.Modal(document.getElementById(lightboxId));modal.show()}
prevImage(){const activeImage=document.querySelector(".lightboxImage").src;const imagesCollection=this.getImagesCollection();let index=imagesCollection.findIndex(img=>img.src===activeImage)-1;if(index<0)index=imagesCollection.length-1;document.querySelector(".lightboxImage").src=imagesCollection[index].src}
nextImage(){const activeImage=document.querySelector(".lightboxImage").src;const imagesCollection=this.getImagesCollection();let index=imagesCollection.findIndex(img=>img.src===activeImage)+1;if(index>=imagesCollection.length)index=0;document.querySelector(".lightboxImage").src=imagesCollection[index].src}
getImagesCollection(){const activeTag=document.querySelector(".tags-bar .active-tag").dataset.imagesToggle;const imagesCollection=[];document.querySelectorAll(".item-column img").forEach((img)=>{const tag=img.dataset.galleryTag;if(activeTag==="all"||tag===activeTag){imagesCollection.push(img)}});return imagesCollection}
createLightBox(){const lightboxId=this.options.lightboxId||"galleryLightbox";const modal=document.createElement('div');modal.className='modal fade';modal.id=lightboxId;modal.tabIndex=-1;modal.role="dialog";modal.setAttribute("aria-hidden","true");modal.innerHTML=`
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-body">
            ${this.options.navigation ? '<div class="mg-prev" style="cursor:pointer;position:absolute;top:50%;left:-15px;background:white;"><</div>' : ''}
            <img class="lightboxImage img-fluid" alt="Contenu de l'image affichÃ©e dans la modale au clique"/>
            ${this.options.navigation ? '<div class="mg-next" style="cursor:pointer;position:absolute;top:50%;right:-15px;background:white;">></div>' : ''}
          </div>
        </div>
      </div>
    `;this.element.appendChild(modal)}
showItemTags(){let tagItems=`<li class="nav-item"><span class="nav-link active active-tag" data-images-toggle="all">Tous</span></li>`;this.tagsCollection.forEach(value=>{tagItems+=`<li class="nav-item"><span class="nav-link" data-images-toggle="${value}">${value}</span></li>`});const tagsRow=`<ul class="my-4 tags-bar nav nav-pills">${tagItems}</ul>`;this.element.insertAdjacentHTML('afterbegin',tagsRow)}
filterByTag(e){const target=e.target;if(target.classList.contains("active-tag"))return;document.querySelector(".active-tag").classList.remove("active","active-tag");target.classList.add("active-tag","active");const tag=target.dataset.imagesToggle;document.querySelectorAll(".gallery-item").forEach((item)=>{const parentColumn=item.closest(".item-column");parentColumn.style.display="none";if(tag==="all"||item.dataset.galleryTag===tag){parentColumn.style.display="block"}})}}
const galleryElement=document.querySelector('.gallery');const gallery=new mauGallery(galleryElement,{columns:4,lightBox:!0,showTags:!0,navigation:!0})